title:: 2022/8/3

- [[22_Code_Sql]]
   **自己寫：SQL中@variable無法判斷帶入1~n個變數，若要在類似Function中帶入1~n個變數，需寫成EXEC寫法DECLARE @issueid NVARCHAR(100), @sqlscript1 NVARCHAR(Max)
  SET @issueid = '''1234'',''1235'',''1236'''
  SET @sqlscript1 = 
  	'SELECT IssueID, Detail
  	FROM tcithelpdesk.[dbo].[Issue] WITH(NOLOCK)
  	WHERE issueid IN ('+@issueid+')
  	ORDER BY issueid'
  EXEC(@sqlscript1)**
  ```
  DECLARE @issueid NVARCHAR(100), @sqlscript1 NVARCHAR(Max), @sqlscript2 NVARCHAR(Max), @sqlscript3 NVARCHAR(Max), @sqlscript4 NVARCHAR(Max)
  SET @issueid = '''55786'',''56433'',''57025'',''56905'',''56165'''
  
  SET @sqlscript1 = 
  	'SELECT IssueID, Detail
  	FROM tcithelpdesk.[dbo].[Issue] WITH(NOLOCK)
  	WHERE issueid IN ('+@issueid+')
  	ORDER BY issueid'
  EXEC(@sqlscript1)
  
  SET @sqlscript2 = 
  	'SELECT status, creator, categoryid, issueid, creationdate, assignedto, companyid, closeddate, priority
  	FROM tcithelpdesk.[dbo].[Issue] WITH(NOLOCK)
  	WHERE issueid IN ('+@issueid+')
  	ORDER BY issueid'
  EXEC(@sqlscript2)
  
  SET @sqlscript3 = 
  	'SELECT issueID--, AttachmentName
  			,SUBSTRING(AttachmentName, 1, CHARINDEX(''----'',AttachmentName)-1) FileName
  			,SUBSTRING(AttachmentName, CHARINDEX(''----'', AttachmentName) + 4, len(AttachmentName)) UploadTime
  			,SUBSTRING(AttachmentContent, 1, 11) BinaryFile
  	--SELECT * 
  	FROM tcithelpdesk.[dbo].[Attachment] WITH(NOLOCK)
  	WHERE issueid IN ('+@issueid+')
  	ORDER BY issueid'
  EXEC(@sqlscript3)
  
  SET @sqlscript4 = 
  	'SELECT issueid, Creationdate, creator, detail
  	FROM tcithelpdesk.[dbo].[IssueLog] WITH(NOLOCK)
  	WHERE issueid IN ('+@issueid+')
  	ORDER BY issueid'
  EXEC(@sqlscript4)
  
  下方為沒帶入變數時的寫法
  /*
  --slide1
  SELECT IssueID, Detail
  FROM tcithelpdesk.[dbo].[Issue] WITH(NOLOCK)
  WHERE issueid IN ('55786','56433','57025','56905','56165')
  ORDER BY issueid
  
  --slide2
  SELECT status, creator, categoryid, issueid, creationdate, assignedto, companyid, closeddate, priority
  FROM tcithelpdesk.[dbo].[Issue] WITH(NOLOCK)
  WHERE issueid IN ('55786','56433','57025','56905','56165')
  ORDER BY issueid
  
  --slide3
  SELECT issueID--, AttachmentName
  		,SUBSTRING(AttachmentName, 1, CHARINDEX('----',AttachmentName)-1)
  		,SUBSTRING(AttachmentName, CHARINDEX('----', AttachmentName) + 4, len(AttachmentName))    
  		,AttachmentContent
  --SELECT * 
  FROM tcithelpdesk.[dbo].[Attachment] WITH(NOLOCK)
  WHERE issueid IN (@issueid)
  ORDER BY issueid
  
  --slide4
  SELECT issueid, Creationdate, creator, detail
  FROM tcithelpdesk.[dbo].[IssueLog] WITH(NOLOCK)
  WHERE issueid in (
  '55786','56433','57025','56905','56165'
  )
  order by issueid
  
  --reference
     select  SUBSTRING('ABC_ALONSO',1,CHARINDEX('_','ABC_ALONSO')-1)  '前面的ABC'
      , SUBSTRING('ABC_ALONSO',CHARINDEX('_','ABC_ALONSO')+1,len('ABC_ALONSO')) 
  ```
-
- [[22_Code_Sql]]
  ****